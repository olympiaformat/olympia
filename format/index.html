
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://olympiaformat.org/format/">
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../iceberg/">
      
      
      <link rel="icon" href="../logo/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.12">
    
    
      
        <title>Format - OLYMPIA FORMAT</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.2afb09e1.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#format" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="OLYMPIA FORMAT" class="md-header__button md-logo" aria-label="OLYMPIA FORMAT" data-md-component="logo">
      
  <img src="../logo/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OLYMPIA FORMAT
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Format
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/olympiaformat/olympia" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"/></svg>
  </div>
  <div class="md-source__repository">
    olympiaformat/olympia
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="OLYMPIA FORMAT" class="md-nav__button md-logo" aria-label="OLYMPIA FORMAT" data-md-component="logo">
      
  <img src="../logo/logo.png" alt="logo">

    </a>
    OLYMPIA FORMAT
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/olympiaformat/olympia" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"/></svg>
  </div>
  <div class="md-source__repository">
    olympiaformat/olympia
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Format
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Format
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#b-tree-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      B-Tree Concepts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="B-Tree Concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#search-tree" class="md-nav__link">
    <span class="md-ellipsis">
      Search Tree
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#n-way-search-tree" class="md-nav__link">
    <span class="md-ellipsis">
      N-Way Search Tree
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#search-tree-map" class="md-nav__link">
    <span class="md-ellipsis">
      Search Tree Map
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-tree" class="md-nav__link">
    <span class="md-ellipsis">
      B-Tree
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pivot-table" class="md-nav__link">
    <span class="md-ellipsis">
      Pivot Table
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#catalog-objects-and-actions" class="md-nav__link">
    <span class="md-ellipsis">
      Catalog Objects and Actions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tree-key-encoding" class="md-nav__link">
    <span class="md-ellipsis">
      Tree Key Encoding
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tree Key Encoding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#system-internal-keys" class="md-nav__link">
    <span class="md-ellipsis">
      System Internal Keys
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#object-key" class="md-nav__link">
    <span class="md-ellipsis">
      Object Key
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Object Key">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#object-name-encoding" class="md-nav__link">
    <span class="md-ellipsis">
      Object Name Encoding
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#object-type-id-encoding" class="md-nav__link">
    <span class="md-ellipsis">
      Object Type ID Encoding
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#object-key-format" class="md-nav__link">
    <span class="md-ellipsis">
      Object Key Format
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#files" class="md-nav__link">
    <span class="md-ellipsis">
      Files
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Files">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#node-file" class="md-nav__link">
    <span class="md-ellipsis">
      Node File
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#root-node-file" class="md-nav__link">
    <span class="md-ellipsis">
      Root Node File
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#object-definition-file" class="md-nav__link">
    <span class="md-ellipsis">
      Object Definition File
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#latest-version-file" class="md-nav__link">
    <span class="md-ellipsis">
      Latest Version File
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oldest-version-file" class="md-nav__link">
    <span class="md-ellipsis">
      Oldest Version File
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transaction" class="md-nav__link">
    <span class="md-ellipsis">
      Transaction
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Transaction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#storage-requirement" class="md-nav__link">
    <span class="md-ellipsis">
      Storage Requirement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#begin-a-transaction" class="md-nav__link">
    <span class="md-ellipsis">
      Begin a transaction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#commit-a-transaction" class="md-nav__link">
    <span class="md-ellipsis">
      Commit a transaction
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Commit a transaction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#storage-atomic-commit" class="md-nav__link">
    <span class="md-ellipsis">
      Storage Atomic Commit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#catalog-commit-conflict-resolution" class="md-nav__link">
    <span class="md-ellipsis">
      Catalog Commit Conflict Resolution
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#distribute-a-transaction" class="md-nav__link">
    <span class="md-ellipsis">
      Distribute a transaction
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#catalog-versioning-semantics" class="md-nav__link">
    <span class="md-ellipsis">
      Catalog Versioning Semantics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Catalog Versioning Semantics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#time-travel" class="md-nav__link">
    <span class="md-ellipsis">
      Time Travel
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#catalog-rollback" class="md-nav__link">
    <span class="md-ellipsis">
      Catalog Rollback
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#snapshot-export" class="md-nav__link">
    <span class="md-ellipsis">
      Snapshot Export
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../iceberg/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Iceberg Catalog Integration
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../spark/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Spark Integration
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../community/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Community
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#b-tree-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      B-Tree Concepts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="B-Tree Concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#search-tree" class="md-nav__link">
    <span class="md-ellipsis">
      Search Tree
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#n-way-search-tree" class="md-nav__link">
    <span class="md-ellipsis">
      N-Way Search Tree
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#search-tree-map" class="md-nav__link">
    <span class="md-ellipsis">
      Search Tree Map
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-tree" class="md-nav__link">
    <span class="md-ellipsis">
      B-Tree
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pivot-table" class="md-nav__link">
    <span class="md-ellipsis">
      Pivot Table
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#catalog-objects-and-actions" class="md-nav__link">
    <span class="md-ellipsis">
      Catalog Objects and Actions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tree-key-encoding" class="md-nav__link">
    <span class="md-ellipsis">
      Tree Key Encoding
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tree Key Encoding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#system-internal-keys" class="md-nav__link">
    <span class="md-ellipsis">
      System Internal Keys
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#object-key" class="md-nav__link">
    <span class="md-ellipsis">
      Object Key
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Object Key">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#object-name-encoding" class="md-nav__link">
    <span class="md-ellipsis">
      Object Name Encoding
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#object-type-id-encoding" class="md-nav__link">
    <span class="md-ellipsis">
      Object Type ID Encoding
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#object-key-format" class="md-nav__link">
    <span class="md-ellipsis">
      Object Key Format
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#files" class="md-nav__link">
    <span class="md-ellipsis">
      Files
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Files">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#node-file" class="md-nav__link">
    <span class="md-ellipsis">
      Node File
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#root-node-file" class="md-nav__link">
    <span class="md-ellipsis">
      Root Node File
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#object-definition-file" class="md-nav__link">
    <span class="md-ellipsis">
      Object Definition File
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#latest-version-file" class="md-nav__link">
    <span class="md-ellipsis">
      Latest Version File
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oldest-version-file" class="md-nav__link">
    <span class="md-ellipsis">
      Oldest Version File
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transaction" class="md-nav__link">
    <span class="md-ellipsis">
      Transaction
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Transaction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#storage-requirement" class="md-nav__link">
    <span class="md-ellipsis">
      Storage Requirement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#begin-a-transaction" class="md-nav__link">
    <span class="md-ellipsis">
      Begin a transaction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#commit-a-transaction" class="md-nav__link">
    <span class="md-ellipsis">
      Commit a transaction
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Commit a transaction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#storage-atomic-commit" class="md-nav__link">
    <span class="md-ellipsis">
      Storage Atomic Commit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#catalog-commit-conflict-resolution" class="md-nav__link">
    <span class="md-ellipsis">
      Catalog Commit Conflict Resolution
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#distribute-a-transaction" class="md-nav__link">
    <span class="md-ellipsis">
      Distribute a transaction
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#catalog-versioning-semantics" class="md-nav__link">
    <span class="md-ellipsis">
      Catalog Versioning Semantics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Catalog Versioning Semantics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#time-travel" class="md-nav__link">
    <span class="md-ellipsis">
      Time Travel
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#catalog-rollback" class="md-nav__link">
    <span class="md-ellipsis">
      Catalog Rollback
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#snapshot-export" class="md-nav__link">
    <span class="md-ellipsis">
      Snapshot Export
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="format">Format</h1>
<p>This page describes the complete Olympia catalog format on storage.</p>
<h2 id="overview">Overview</h2>
<p>The Olympia format defines a set of files that are within a specific prefix.
These files together forms a b-tree that records the information of objects in a catalog.
Here is an example:</p>
<p><img alt="format-overview" src="../format-overview.png" /></p>
<p>The graph above describes an Olympia catalog at storage location <code>/prefix</code>.
The catalog is at version 100 with 1 root node and 3 child nodes forming a b-tree of order 4.
Each node of the b-tree is serialized as a file within the prefix. 
The root node is at location <code>/prefix/vn/00100110000000000000000000000000</code>,
and 3 child nodes at locations within <code>/prefix/node/</code>.</p>
<p>The b-tree is used as a key-value map, where the key encodes the object name,
and the value is a location within prefix that has the definition of the object as a serialized protobuf file.
For example, in this catalog there are object keys like <code>catalog_def</code>, <code>ns1</code>, <code>ns2.table2</code>, etc. with their corresponding definitions
as files at locations within <code>/prefix/def/</code>.</p>
<h2 id="b-tree-concepts">B-Tree Concepts</h2>
<h3 id="search-tree">Search Tree</h3>
<p>A search tree is a tree data structure used for locating specific <strong>Key</strong>s from within a collection of keys,
and used as an implementation of a <strong>Set</strong>. 
A search tree consists of a collection of <strong>Node</strong>s, and each node contains an ordered collection of keys.
To find if a target key is in the tree set, run the following algorithm:</p>
<p>Start from the root node, we first check see if the target is in the node.
If not, find the 2 consecutive keys that bound the target, or if the target is smaller or larger than all keys in the node.
This will either lead to searching a subsequent child node and eventually find the target in the set,
or if there is no child node to search, the key is not in the set.</p>
<h3 id="n-way-search-tree">N-Way Search Tree</h3>
<p>A <strong>N-way search tree</strong> is a search tree where:</p>
<ol>
<li>A node with <code>k</code> children must have <code>k-1</code> number of keys.</li>
<li>Each node must have a maximum of <code>N</code> child nodes (i.e. each node must have a maximum of <code>N-1</code> keys)</li>
</ol>
<h3 id="search-tree-map">Search Tree Map</h3>
<p>A search tree can not only be used as the implementation of a set, but also a key-value <strong>Map</strong>.
This can be achieved by storing the value together with its corresponding key.</p>
<p>When we talk about a tree in the context of Olympia, it is always a search tree map.
It is also common for a value in the map to be pointers to a much larger payload on disk.</p>
<h3 id="b-tree">B-Tree</h3>
<p>An N-way search tree only enforces the general requirements for the number of
children per tree node. The tree could become imbalanced over time. 
A b-tree (balanced tree) of order N is a self-balancing
N-way search tree that enforces a set of rules when updating the tree:</p>
<ol>
<li>All leaf nodes must appear at the same level</li>
<li>The root node must have at least 2 children, unless it is also a leaf</li>
<li>All nodes, except for the root node and leaves, must have at least <code>⌈N/2⌉</code> children</li>
</ol>
<h3 id="pivot-table">Pivot Table</h3>
<p>For each node of a b-tree, there is an internal mapping of key to value and child node pointers.
A <strong>Pivot Table</strong> provides a way to describe such information in a tabular fashion.</p>
<p>Every key, value and node pointer tuple forms a row in this pivot table.
There are exactly <code>N</code> rows for each node in a <code>N</code>-way search tree.
The construction of the table follows the rules below:</p>
<ol>
<li>The first row must have <code>NULL</code> key and <code>NULL</code> value, and the node pointer (if exists) points to the leftest child node.</li>
<li>Subsequent rows must be filled with non-null key and value from left to right.
   The node pointer at the row (if exists) points to the right child node of the key at the same row.</li>
<li>If there are less than <code>N-1</code> keys available to form <code>N</code> rows, the remaining rows are filled with all <code>NULL</code> values for key,
   value and node pointer.</li>
</ol>
<p>For example, the pivot table of the root node in the example in overview would look something like:</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
<th>Node Pointer</th>
</tr>
</thead>
<tbody>
<tr>
<td>NULL</td>
<td>NULL</td>
<td>node/&lt;some random value&gt;.arrow</td>
</tr>
<tr>
<td>ns1</td>
<td>def/&lt;some random value&gt;.binpb</td>
<td>node/&lt;some random value&gt;.arrow</td>
</tr>
<tr>
<td>ns2</td>
<td>def/&lt;some random value&gt;.binpb</td>
<td>node/&lt;some random value&gt;.arrow</td>
</tr>
</tbody>
</table>
<h2 id="catalog-objects-and-actions">Catalog Objects and Actions</h2>
<p>Each type of object in a catalog has a Protobuf definition, as well as a set of actions related to the object.
See <a href="https://github.com/olympiaformat/olympia/blob/main/proto/objects.proto">objects.proto</a> and 
<a href="https://github.com/olympiaformat/olympia/blob/main/proto/actions.proto">actions.proto</a> for the actual definitions.</p>
<p>Each object has an increasing numeric type ID starting from 0.
At this moment, Olympia supports the following objects with their corresponding ID:</p>
<table>
<thead>
<tr>
<th>Object Type</th>
<th>ID</th>
</tr>
</thead>
<tbody>
<tr>
<td>Catalog</td>
<td>0</td>
</tr>
<tr>
<td>Namespace</td>
<td>1</td>
</tr>
<tr>
<td>Table</td>
<td>2</td>
</tr>
<tr>
<td>View</td>
<td>3</td>
</tr>
<tr>
<td>Distributed Transaction</td>
<td>4</td>
</tr>
</tbody>
</table>
<h2 id="tree-key-encoding">Tree Key Encoding</h2>
<p>There are 2 types of keys in the Olympia b-tree: system internal keys and object keys.</p>
<h3 id="system-internal-keys">System Internal Keys</h3>
<p>System internal keys do not participate in the Olympia tree key sorting algorithm
and just provide metadata information about the specific node. Here is a list of them:</p>
<table>
<thead>
<tr>
<th>Key Name</th>
<th>Key</th>
<th>Root Node Only</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Catalog Definition</td>
<td>catalog_def</td>
<td>Yes</td>
<td>The catalog definition file pointer</td>
</tr>
<tr>
<td>Previous Root Node</td>
<td>previous_root</td>
<td>Yes</td>
<td>The pointer to the last version of the root node</td>
</tr>
<tr>
<td>Rollback Root Node</td>
<td>rollback_from_root</td>
<td>Yes</td>
<td>The pointer to the root node that was rolled back from, if the root node is created during a rollback</td>
</tr>
<tr>
<td>Creation Timestamp</td>
<td>created_at_millis</td>
<td></td>
<td>The millisecond epoch timestamp that a node is created</td>
</tr>
<tr>
<td>Number of Keys</td>
<td>n_keys</td>
<td></td>
<td>The number of rows that a node has</td>
</tr>
</tbody>
</table>
<h3 id="object-key">Object Key</h3>
<p>The object key is a UTF-8 string that uniquely identifies the object and also allows sorting it in a
lexicographical order that resembles the object hierarchy in a catalog.</p>
<h4 id="object-name-encoding">Object Name Encoding</h4>
<p>The object name has maximum size in bytes defined in the catalog definition file,
with one configuration for each type of object.</p>
<p>The following UTF-8 characters are not permitted in an object name:</p>
<ul>
<li>any control characters (hex value 00 to 1F)</li>
<li>the space character (hex value 20)</li>
<li>the DEL character (hex value 7F)</li>
</ul>
<p>When used in an object key, the object name is right-padded with space up to the maximum size
(excluding the initial byte). The maximum size of each object is defined in the catalog definition file.</p>
<p>For example, a namespace <code>default</code> under catalog definition
<code>namespace_name_max_size_bytes=8</code> will have an encoded object name<code>[space]default[space]</code>.</p>
<h4 id="object-type-id-encoding">Object Type ID Encoding</h4>
<p>When used in the object key, the object type ID is encoded to a 4 character base64 string that uses the following encoding:</p>
<ul>
<li>Uppercase letters: A–Z, with indices 0–25</li>
<li>Lowercase letters: a–z, with indices 26–51</li>
<li>Digits: 0–9, with indices 52–61</li>
<li>Special symbols: <code>+</code> and <code>-</code>, with indices 62–63</li>
<li>Right padding character <code>=</code> if there are fewer than 4 characters after encoding</li>
</ul>
<p>For example, object type ID <code>4</code> is encoded to <code>E===</code>.</p>
<h4 id="object-key-format">Object Key Format</h4>
<p>The object key format combines the encoded object key ID and encoded object name above to form a unique key
for each type of object. See the table below for the format for each type of object: 
(contents in <code>&lt;&gt;</code> should be substituted, space character is expressed as <code>[space]</code> for clarity)</p>
<table>
<thead>
<tr>
<th>Object Type</th>
<th>Object Key Format</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>Catalog</td>
<td>N/A, use the catalog definition key</td>
<td></td>
</tr>
<tr>
<td>Namespace</td>
<td><code>B===&lt;encoded namespace name&gt;</code></td>
<td><code>B===default[space]</code></td>
</tr>
<tr>
<td>Table</td>
<td><code>C===&lt;encoded namespace name&gt;&lt;encoded table name&gt;</code></td>
<td><code>C===default[space]table[space][space][space]</code></td>
</tr>
<tr>
<td>View</td>
<td><code>D===&lt;encoded namespace name&gt;&lt;encoded view name&gt;</code></td>
<td><code>D===default[space]view[space][space][space][space]</code></td>
</tr>
<tr>
<td>Distributed Transaction</td>
<td>N/A, distributed transaction is not persisted in catalog</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="files">Files</h2>
<p>Here are the different types of files.</p>
<h3 id="node-file">Node File</h3>
<p>To persist the whole tree on storage, each pivot table is stored as a separated file that we call a <strong>Node File</strong>.
However, before storing the pivot table, it stores the system internal keys relevant to the node.
Because the pivot table must begin with a row of key and value both being <code>NULL</code>,
It is expected that a reader first read up to the first row of the pivot table, and read N keys of the pivot table
based on the "Number of Keys" system internal key.</p>
<p>Node files are stored under <code>node</code> folder within the catalog prefix, each node file is in Apache Arrow IPC format
with file name in the form of <code>&lt;random uuid4&gt;.arrow</code>.</p>
<h3 id="root-node-file">Root Node File</h3>
<p>Root node file is a special kind of node file.</p>
<p>It also stores a list of actions performed in the last transaction after the pivot table.
For these rows, the <code>key</code> column stores the object that the action is performed on. 
The <code>value</code> column stores the action definition.</p>
<p>Root node files are stored in the <code>vn</code> (version) folder.
Each root node file is stored as the reversed binary value of the version number.
For example, version 100 is stored at <code>vn/00100110000000000000000000000000</code>.</p>
<h3 id="object-definition-file">Object Definition File</h3>
<p>Object definition files store the serialized protobuf binary for the specific object.</p>
<p>These files are stored in the <code>def</code> folder,
in the form of prefix <code>{object-type}/{uuid4}-{object-identifier}.binpb</code>.
For example, a table <code>t1</code> in namespace <code>ns1</code> and UUID <code>6fcb514b-b878-4c9d-95b7-8dc3a7ce6fd8</code> would give a path
<code>table/6fcb514b-b878-4c9d-95b7-8dc3a7ce6fd8-ns1-t1.binpb</code>,
to produce the final object definition file path.
For catalog, because thee is not an object identifier, files will be in the form of <code>catalog/{uuid4}.binpb</code>.</p>
<h3 id="latest-version-file">Latest Version File</h3>
<p>The latest version file is stored at <code>vn/latest</code>.
This is an optional text file that records the latest version of the node file,
The file contains a number that marks the presumably latest version of the tree root node, such as <code>100</code>.</p>
<h3 id="oldest-version-file">Oldest Version File</h3>
<p>The oldest version file is stored at <code>vn/oldest</code>.
This is an optional text file marks the guaranteed oldest version of the tree root node, such as <code>100</code>.</p>
<h2 id="transaction">Transaction</h2>
<h3 id="storage-requirement">Storage Requirement</h3>
<p>A storage used by Olympia must support the following basic operations:</p>
<ul>
<li>Read a file to a given location</li>
<li>Write a file to a given location</li>
<li>Delete a file at a given location</li>
<li>Check if a file exists at a given location</li>
<li>List files sharing the same prefix</li>
</ul>
<p>In addition, a storage used by Olympia must support mutual exclusion of file creation.
This means only one writer wins if there are multiple writers trying to write to the same new file.
This is the key feature that Olympia relies on for enforcing ACID semantics during the commit process.</p>
<p>This feature is widely available in most storage systems, for examples:</p>
<ul>
<li>On Linux File System through <a href="https://linux.die.net/man/2/open">O_EXCL</a></li>
<li>On Hadoop Distributed File System through <a href="https://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-common/filesystem/filesystem.html#boolean_rename.28Path_src.2C_Path_d.29">atomic rename</a></li>
<li>On Amazon S3 through <a href="https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutObject.html#API_PutObject_RequestSyntax">IF-NONE-MATCH</a></li>
<li>On Google Cloud Storage through <a href="https://cloud.google.com/storage/docs/xml-api/reference-headers#ifnonematch">IF-NONE-MATCH</a></li>
<li>On Azure Data Lake Storage through <a href="https://learn.microsoft.com/en-us/rest/api/storageservices/specifying-conditional-headers-for-blob-service-operations">IF-NONE-MATCH</a></li>
</ul>
<p>We can also treat key-value stores as a file system, where the key records the file path and value stores the file content bytes.
This further enables the usage of systems like:</p>
<ul>
<li>On Amazon DynamoDB through <a href="https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_PutItem.html">conditional PutItem</a></li>
<li>On Redis/Valkey through <a href="https://valkey.io/commands/set/">SET NX</a></li>
</ul>
<h3 id="begin-a-transaction">Begin a transaction</h3>
<p>A transaction, either for read or write or both, will always begin with identifying the version of the Olympia tree
to look into. This version is determined by reading the latest and oldest version files.
If the latest version file exists and is larger than the oldest version file or if the oldest version file does not exist, 
we start to find the latest version at the version indicated by the file. 
Otherwise, we start from the version described by the oldest version file, or 0 if the oldest version file does not exist.
With that, we consecutively increment the version number until we find the verison <code>k</code> that returns a file not found error from storage.
After this process, we treat version <code>k-1</code> as the latest version to be used.</p>
<h3 id="commit-a-transaction">Commit a transaction</h3>
<h4 id="storage-atomic-commit">Storage Atomic Commit</h4>
<p>When committing a transaction, the writer will first write all non-root node files in parallel,
and then write the new root node file at the new version location atomically.
If this write is successful, the transaction is considered succeeded,
and the writer will perform a best-effort write of the latest version file.
If this write is not successful, the transaction commit step has failed at the storage layer.
Additional catalog commit conflict resolution is required to determine the proper action.</p>
<h4 id="catalog-commit-conflict-resolution">Catalog Commit Conflict Resolution</h4>
<p>When a commit fails at storage level, catalog will examine all the actions performed by
inspecting the list of actions stored in the latest root node,
and reconcile with the current list of actions to see if the commit could still succeed.
If the commit could still succeed, the writer should update the commit to be performed against the latest root node
and redo the storage atomic commit.
Otherwise, the commit process should abort and report failure.</p>
<h3 id="distribute-a-transaction">Distribute a transaction</h3>
<p>A transaction can be distributed by creating a distributed transaction object.
These objects are stored in the <code>dtxn</code> folder with name <code>{transaction-id}.binpb</code>.
The transaction can be resumed in another process by loading the specific distributed transaction object definition.</p>
<h2 id="catalog-versioning-semantics">Catalog Versioning Semantics</h2>
<p>Here are the semantics to follow for catalog versioning related features of Olympia:</p>
<h3 id="time-travel">Time Travel</h3>
<p>Because the Olympia tree node is versioned, time travel against the tree root,
i.e. time travel against the entire Olympia catalog, is possible.</p>
<p>The timestamp-based time travel can be achieved by continuously tracing the previous root node key
to older root nodes, and check the creation timestamp key until the right root
node for time travel is found.</p>
<p>For version-based time travel, when the system version is a numeric value, it should map to the version of the tree root node.
The root node of the specific version can directly be found based on the root node file name.
When the system version is a string that does not resemble a numeric value, it should map to a possible exported snapshot.</p>
<h3 id="catalog-rollback">Catalog Rollback</h3>
<p>Olympia uses the roll forward technique for rolling back any committed version.
If the current latest root node version is <code>v</code>, and a user would like to roll back to version <code>v-1</code>,
Rollback is performed by committing a new root node with version <code>v+1</code> which is most identical to the root node file <code>v-1</code>,
with the difference that the root node <code>v</code> should be recorded as the rollback root node key.</p>
<h3 id="snapshot-export">Snapshot Export</h3>
<p>A snapshot export for an Olympia catalog means to export a specific version of the Olympia tree root node,
and all the files that are reachable through that root node.
Every time an export is created, the catalog definition should be updated to record the name of the export
and the root node file that the export is at.</p>
<p>There are many types of export that can be achieved, because the export process can decide to stop replication
at any level of the tree and call it an export.
At one extreme, a process can replicate any reachable files starting at the root node. We call this a <strong>Full Export</strong>.
On the other side, a process can simply replicate the specific version of tree root node,
and all other files reachable from the root node are not replicated. We call this a <strong>Minimal Export</strong>.
We call any export that is in between a <strong>Partial Export</strong>.</p>
<p>Any file that is referenced by both the exported snapshot and the source catalog might be removed by the
catalog version expiration process.
With a full snapshot export, all files are replicated and dereferenced from the source catalog.
With a partial or minimal export, additional retention policy settings are required to make sure the
version expiration process still keep those files available for a certain amount of time.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["search.suggest"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>